---
title: "plots"
author: "Чебакова Майя"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Построение необходимых графиков.

```{r}
library(ggplot2)
library(dplyr)

# Функция для степенного гамма-распределения
power_gamma_density <- function(x, kappa, beta, lambda) {
  coef <- kappa / (beta^lambda * gamma(lambda))
  coef * x^(kappa * lambda - 1) * exp(-x^kappa / beta)
}

# Значения x
x_vals <- seq(0.01, 45, length.out = 1000)

# Список плотностей
densities <- list(
  "LOW  (λ=1.72, β=7.65)" = power_gamma_density(x_vals, params_low["kappa"], params_low["beta"], params_low["lambda"]),
  "HIGH (λ=2.71, β=4.62)" = power_gamma_density(x_vals, params_high["kappa"], params_high["beta"], params_high["lambda"]),
  "LOW ном. (κ=0.77, λ=2.74, β=2.52)" = power_gamma_density(x_vals, params_low_nom["kappa"], params_low_nom["beta"], params_low_nom["lambda"]),
  "HIGH ном. (κ=0.76, λ=4.51, β=1.46)" = power_gamma_density(x_vals, params_high_nom["kappa"], params_high_nom["beta"], params_high_nom["lambda"])
)

# Датафрейм
plot_data <- do.call(rbind, lapply(names(densities), function(name) {
  data.frame(
    x = x_vals,
    density = densities[[name]],
    group = name
  )
}))

# Явные стили: цвет и тип линии
line_styles <- c(
  "LOW  (λ=1.72, β=7.65)" = "solid",
  "HIGH (λ=2.71, β=4.62)" = "solid",
  "LOW ном. (κ=0.77, λ=2.74, β=2.52)" = "dashed",
  "HIGH ном. (κ=0.76, λ=4.51, β=1.46)" = "dashed"
)

line_colors <- c(
  "LOW  (λ=1.72, β=7.65)" = "blue",
  "HIGH (λ=2.71, β=4.62)" = "red",
  "LOW ном. (κ=0.77, λ=2.74, β=2.52)" = "blue",
  "HIGH ном. (κ=0.76, λ=4.51, β=1.46)" = "red"
)

# Построение графика
ggplot(plot_data, aes(x = x, y = density, color = group, linetype = group)) +
  geom_line(size = 1) +
  labs(
    x = "x", y = "Плотность"
  ) +
  scale_color_manual(values = line_colors) +
  scale_linetype_manual(values = line_styles) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = c(0.97, 0.97),
    legend.justification = c("right", "top"),
    legend.background = element_rect(fill = "white", color = "gray80"),
    legend.title = element_blank(),
    legend.text = element_text(size = 10)
  )

```


```{r}
library(ggplot2)
library(dplyr)

# Функция для степенного гамма-распределения
power_gamma_density <- function(x, kappa, beta, lambda) {
  coef <- kappa / (beta^lambda * gamma(lambda))
  coef * x^(kappa * lambda - 1) * exp(-x^kappa / beta)
}

# Значения x
x_vals <- seq(0.01, 45, length.out = 1000)

# Пример параметров (замени на свои)
params_low <- c(kappa = 1, lambda = 1.72, beta = 7.65)
params_low_nom <- c(kappa = 0.77, lambda = 2.74, beta = 2.52)

# Названия групп — в expression
group_labels <- list(
  "LOW" = "Γ(λ=1.72, β=7.65)",
  "LOW_nom" = "γ(κ=0.77, λ=2.74, β=2.52)"
)

# Вычисляем плотности
densities <- list(
  "LOW" = power_gamma_density(x_vals, params_low["kappa"], params_low["beta"], params_low["lambda"]),
  "LOW_nom" = power_gamma_density(x_vals, params_low_nom["kappa"], params_low_nom["beta"], params_low_nom["lambda"])
)

# Формируем датафрейм
plot_data <- bind_rows(
  lapply(names(densities), function(name) {
    data.frame(
      x = x_vals,
      density = densities[[name]],
      group = name
    )
  })
)

# Цвета и линии
line_colors <- c("LOW" = "blue", "LOW_nom" = "blue")
line_styles <- c("LOW" = "solid", "LOW_nom" = "dashed")

# Построение графика
ggplot(plot_data, aes(x = x, y = density, color = group, linetype = group)) +
  geom_line(size = 1) +
  labs(
    x = "x", y = "Плотность"
  ) +
  scale_color_manual(
    values = line_colors,
    labels = group_labels
  ) +
  scale_linetype_manual(
    values = line_styles,
    labels = group_labels
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = c(0.97, 0.97),
    legend.justification = c("right", "top"),
    legend.background = element_rect(fill = "white", color = "gray80"),
    legend.title = element_blank(),
    legend.text = element_text(size = 18),         # Размер шрифта
  legend.key.size = unit(1.5, "lines"),          # Размер квадратиков
  legend.spacing.y = unit(0.8, "lines")    
  )

```



```{r}
library(ggplot2)
library(tidyr)

# Преобразуем данные в длинный формат для ggplot
plot_data <- pivot_longer(
  power_results,
  cols = starts_with("power_"),
  names_to = "test",
  values_to = "power"
)

# Человеческие подписи тестов
plot_data$test <- factor(plot_data$test, levels = c(
  "power_beta_t", "power_beta_ks", "power_beta_w"
), labels = c(
  "Стьюдента",
  "Колмогорова–Смирнова",
  "Манна–Уитни"
))

# График
ggplot(plot_data, aes(x = n, y = power, color = test)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(limits = c(0, 1), name = "Мощность теста") +
  scale_x_continuous(name = "Размер выборки n") +
  labs(color = "Тест") +
  theme_minimal(base_size = 12) +
  theme(legend.position = "top")+
  scale_color_manual(
  values = c(
    "Стьюдента" = "blue",
    "Колмогорова–Смирнова" = "forestgreen",
    "Манна–Уитни" = "red"
  )
)

```


```{r}
library(ggplot2)
library(tidyr)

# Преобразуем данные в длинный формат для ggplot
plot_data <- pivot_longer(
  power_results_lambda,
  cols = starts_with("power_"),
  names_to = "test",
  values_to = "power"
)

# Человеческие подписи тестов
plot_data$test <- factor(plot_data$test, levels = c(
  "power_lam_t", "power_lam_ks", "power_lam_w"
), labels = c(
  "Стьюдента",
  "Колмогорова–Смирнова",
  "Манна–Уитни"
))

# График
ggplot(plot_data, aes(x = n, y = power, color = test)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(limits = c(0.4, 1), name = "Мощность теста") +
  scale_x_continuous(name = "Размер выборки n") +
  labs(color = "Тест") +
  theme_minimal(base_size = 12) +
  theme(legend.position = "top")+
  scale_color_manual(
  values = c(
    "Стьюдента" = "blue",
    "Колмогорова–Смирнова" = "forestgreen",
    "Манна–Уитни" = "red"
  )
)

```


```{r}
# создаем датафрейм из двух векторов
boxplot_df <- data.frame(
  eps_shift = c(resid_low, resid_high),
  group = factor(c(rep("LOW", length(resid_low)), rep("HIGH", length(resid_high))))
)

library(ggplot2)

ggplot(boxplot_df, aes(x = group, y = eps_shift, fill = group)) +
  geom_boxplot(width = 0.5, outlier.shape = NA) +  
  labs(x = "Группа", y = expression(epsilon^{shift})) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(color = "black"),
    plot.margin = margin(0, 150, 0, 0)  
  ) +
  coord_cartesian(ylim = c(0, 35))

```




```{r}
library(ggplot2)

J_mean <- mean(results_nom_gamma$J)

ggplot(results_nom_gamma, aes(x = n, y = J)) +
geom_point(size = 0.7) +
geom_hline(yintercept = J_mean, linetype = "dashed", color = "red") +
annotate("text", x = max(results_nom_gamma$n)*0.85, y = J_mean - 2*0.00005,
label = paste0("Среднее J = ", round(J_mean, 5)),
color = "red", size = 3.5) +
labs(
title = "Расстояние J между распределением и его номинативным",
x = "Объём выборки ",
y = "J"
) +
scale_y_continuous(limits = c(min(results_nom_gamma$J), max(results_nom_gamma$J) + 0.0001)) +
theme_minimal() +
theme(
plot.title = element_text(size = 13, face = "bold", hjust = 0.5)
)

```


```{r}
library(ggplot2)

J_mean <- mean(results_nom_gamma$J)

ggplot(results_nom_gamma, aes(x = n, y = J)) +
  geom_line(size = 1, color = "red") +
  labs(
    title = "Информационное расстояние J",
    x = "Объём выборки",
    y = "J"
  ) +
  scale_y_continuous(limits = c(min(results_nom_gamma$J), max(results_nom_gamma$J) + 0.0001)) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 13, face = "bold", hjust = 0.5)
  )

```

```{r}
library(ggplot2)
library(dplyr)


# Значения x
x_vals <- seq(0.01, 45, length.out = 1000)

# Список плотностей
densities <- list(
  "LOW" = dgamma(x_vals, params_low["lambda"], 1/params_low["beta"]),
  "HIGH" = dgamma(x_vals, params_high["lambda"], 1/params_high["beta"]))

# Датафрейм
plot_data <- do.call(rbind, lapply(names(densities), function(name) {
  data.frame(
    x = x_vals,
    density = densities[[name]],
    group = name
  )
}))

# Явные стили: цвет и тип линии
line_styles <- c(
  "LOW" = "solid",
  "HIGH" = "solid"
)

line_colors <- c(
  "LOW" = "blue",
  "HIGH" = "red"
)

ggplot(plot_data, aes(x, density,
                      color = group, linetype = group)) +
  geom_line(size = 1) +
  scale_color_manual(values = line_colors,
                     labels = c("HIGH (λ=2.71, β=4.62)",
                                "LOW  (λ=1.72, β=7.65)" )) +
  scale_linetype_manual(values = line_styles,
                        labels = c("HIGH (λ=2.71, β=4.62)","LOW  (λ=1.72, β=7.65)"
                                   )) +
  labs(x = "x", y = "Плотность") +
  theme_minimal(base_size = 13) +
  theme(legend.position = c(0.95, 0.95),
        legend.justification = c("right", "top"),
        legend.background   = element_rect(fill = "white", color = "gray80"),
        legend.title        = element_blank(),
        legend.text = element_text(size = 18),
        plot.margin = margin(0, 0, 0, 0))

```



```{r}
library(ggplot2)

ggplot(syn_table_low, aes(x = kappa2, y = H22)) +
geom_line(color = "blue", size = 1) +
geom_point(data = subset(syn_table_low, nominee == TRUE),
aes(x = kappa2, y = H22),
color = "red", size = 3, shape = 18) +
labs(
title = expression(paste("Cобственная энтропия")),
x = expression(kappa[2]),
y = expression(H[22])
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 13, hjust = 0.5)
)

```













